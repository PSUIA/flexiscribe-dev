generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  STUDENT
  EDUCATOR
}

enum Gender {
  MALE
  FEMALE
  OTHER
  PREFER_NOT_TO_SAY
}

model User {
  id       String @id @default(cuid())
  email    String @unique
  password String
  role     Role

  // Role-specific relations
  student  Student?
  educator Educator?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Student {
  id            String   @id @default(cuid())
  studentNumber String   @unique
  fullName      String
  yearLevel     String
  section       String
  program       String
  gender        Gender
  birthDate     DateTime

  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  quizAttempts  QuizAttempt[]
}

model Educator {
  id        String   @id @default(cuid())
  username  String   @unique
  fullName  String
  gender    Gender
  birthDate DateTime

  departmentId String
  department   Department @relation(fields: [departmentId], references: [id])

  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Department {
  id        String     @id @default(cuid())
  name      String     @unique
  educators Educator[]
}

enum QuizType {
  MCQ
  FILL_IN_BLANK
  FLASHCARD
}

enum Difficulty {
  EASY
  MEDIUM
  HARD
}

model Lesson {
  id          String   @id @default(cuid())
  title       String
  subject     String
  content     String   @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  quizzes     Quiz[]
  
  @@index([subject])
}

model Quiz {
  id            String     @id @default(cuid())
  lessonId      String
  lesson        Lesson     @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  
  type          QuizType
  difficulty    Difficulty
  totalQuestions Int
  
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  
  questions     QuizQuestion[]
  attempts      QuizAttempt[]
  
  @@index([lessonId])
}

model QuizQuestion {
  id            String   @id @default(cuid())
  quizId        String
  quiz          Quiz     @relation(fields: [quizId], references: [id], onDelete: Cascade)
  
  questionText  String   @db.Text
  questionData  Json     // Stores type-specific data (choices, answer, distractors, etc.)
  orderIndex    Int
  
  createdAt     DateTime @default(now())
  
  @@index([quizId])
}

model QuizAttempt {
  id          String   @id @default(cuid())
  quizId      String
  quiz        Quiz     @relation(fields: [quizId], references: [id], onDelete: Cascade)
  
  studentId   String
  student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  score       Float
  totalQuestions Int
  answers     Json     // Stores student answers
  completedAt DateTime @default(now())
  
  @@index([quizId])
  @@index([studentId])
}

